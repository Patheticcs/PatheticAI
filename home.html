<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PatheticAI</title>
    <link href="https://api.fontshare.com/v2/css?f[]=cabinet-grotesk@700,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="description" content="PatheticAI is an AI chatbot designed to assist, automate tasks, and provide real-time conversations with users.">
    <meta property="og:description" content="PatheticAI is an AI chatbot designed to assist, automate tasks, and provide real-time conversations with users.">
    <meta property="og:title" content="Pathetic">
    <meta property="og:image" content="/favicon.png">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="PatheticAI">
    <meta property="og:locale" content="en_US">
    <link rel="icon" href="/favicon.png" type="image/png">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Cabinet Grotesk', sans-serif;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
:root {
  --container-width: 90%;
  --container-max-width: 800px;
  --spacing-normal: 20px;
  --spacing-small: 10px;
  --border-radius: 30px;
  --border-radius-small: 15px;
}

:root[data-theme="dark"] {
  --background-color: #121212;
  --primary-color: #ffffff;
  --secondary-color: #bb86fc;
  --border-color: rgba(255, 255, 255, 0.1);
  --chat-message-background: rgba(0, 0, 0, 0.25);
  --taskbar-background: rgba(0, 0, 0, 0.4);
  --input-background: rgba(0, 0, 0, 0.6);
  --button-background: rgba(255, 255, 255, 0.1);
  --button-hover-background: rgba(255, 255, 255, 0.2);
  --modal-background: rgba(0, 0, 0, 0.4);
}

:root[data-theme="light"] {
  --background-color: #ffffff;
  --primary-color: #000000;
  --secondary-color: #6200ea;
  --border-color: rgba(0, 0, 0, 0.1);
  --chat-message-background: rgba(255, 255, 255, 0.25);
  --taskbar-background: rgba(255, 255, 255, 0.8);
  --input-background: rgba(255, 255, 255, 0.9);
  --button-background: rgba(0, 0, 0, 0.1);
  --button-hover-background: rgba(0, 0, 0, 0.2);
  --modal-background: rgba(255, 255, 255, 0.8);
}
      *::-webkit-scrollbar {
        display: none;
      }

      body {
        background: url('https://wallpapershome.com/images/pages/pic_h/26430.jpg') no-repeat center center fixed;
        background-size: cover;
        color: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      :root {
        --container-width: 90%;
        --container-max-width: 800px;
        --spacing-normal: 20px;
        --spacing-small: 10px;
        --border-radius: 30px;
        --border-radius-small: 15px;
      }

      .container {
        position: fixed;
        top: calc(80px + var(--spacing-normal));
        bottom: calc(80px + var(--spacing-normal));
        left: 50%;
        transform: translateX(-50%);
        width: var(--container-width);
        max-width: var(--container-max-width);
        overflow-y: auto;
      }

      .taskbar {
        position: fixed;
        top: var(--spacing-normal);
        left: 50%;
        transform: translateX(-50%);
        width: var(--container-width);
        max-width: var(--container-max-width);
        height: 60px;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 var(--spacing-normal);
        z-index: 1000;
      }

      .taskbar-left {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .brand {
        font-size: 20px;
        font-weight: 700;
        cursor: pointer;
        transition: opacity 0.3s ease;
      }

      .brand:hover {
        opacity: 0.8;
      }

      .preview-tag {
        font-size: 14px;
        opacity: 0.7;
      }

      .taskbar button {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 8px 15px;
        border-radius: 30px;
        cursor: pointer;
        margin-left: 10px;
        transition: all 0.3s ease;
      }

      .taskbar button:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-1px);
      }

      .chat-messages {
        display: flex;
        flex-direction: column;
        gap: 15px;
        padding: 20px;
        padding-bottom: 40px;
        height: 100%;
      }

      .chat-message {
        padding: var(--spacing-normal);
        border-radius: 20px;
        max-width: 85%;
        white-space: pre-wrap;
        line-height: 1.5;
        font-size: clamp(14px, 3vw, 16px);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: messageAppear 0.3s ease;
      }

      .chat-message.user {
        background: rgba(255, 255, 255, 0.25);
        color: white;
        align-self: flex-end;
        border-bottom-right-radius: 5px;
      }

      .chat-message.bot {
        background: rgba(0, 0, 0, 0.25);
        color: white;
        align-self: flex-start;
        border-bottom-left-radius: 5px;
      }

      .chat-input-container {
        position: fixed;
        bottom: var(--spacing-normal);
        left: 50%;
        transform: translateX(-50%);
        width: var(--container-width);
        max-width: var(--container-max-width);
        display: flex;
        gap: 10px;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: var(--spacing-normal);
        border-radius: 30px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .chat-input-container input {
        flex: 1;
        background: transparent;
        border: none;
        outline: none;
        color: white;
        font-size: 16px;
        padding: 0 10px;
      }

      .chat-input-container input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }

      .chat-input-container button {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 8px 20px;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .chat-input-container button:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-1px);
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        animation: fadeIn 0.3s ease;
      }

      .modal-window {
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 30px;
        width: var(--container-width);
        max-width: var(--container-max-width);
        margin: var(--spacing-normal);
        padding: var(--spacing-normal);
        color: white;
        animation: slideUp 0.3s ease;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-title {
        font-size: 24px;
        font-weight: 700;
      }

      .modal-content {
        line-height: 1.6;
        font-size: 16px;
      }

      .modal-content p {
        margin: 5px 0;
      }

      .settings-content {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .settings-button {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 15px;
        border-radius: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .settings-button:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateX(5px);
      }

      .settings-button i {
        width: 20px;
        text-align: center;
      }

      .notification {
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 12px 25px;
        border-radius: 30px;
        backdrop-filter: blur(10px);
        animation: slideUp 0.3s ease;
        z-index: 2000;
      }

      .notification.fade-out {
        animation: fadeOut 0.3s ease;
      }
      
.code-block {
  background: rgba(0, 0, 0, 0.6);
  border-radius: 10px;
  padding: 15px;
  margin: 10px 0;
  position: relative;
}

.code-block pre {
  margin: 0;
  white-space: pre-wrap;
  font-family: 'Fira Code', monospace;
  color: #e0e0e0;
}

.copy-button {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
  padding: 5px 10px;
  border-radius: 15px;
  cursor: pointer;
  font-size: 12px;
}

.message-actions {
  display: flex;
  gap: 5px;
  margin-top: 5px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.chat-message:hover .message-actions {
  opacity: 1;
}

.action-button {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
  padding: 3px 8px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 12px;
}

.edit-mode {
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.edit-input {
  width: 100%;
  background: transparent;
  border: none;
  color: white;
  font-family: inherit;
  font-size: inherit;
  padding: 0;
  margin: 0;
  resize: none;
  outline: none;
}

.theme-selector {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
  padding: 5px 10px;
  border-radius: 15px;
  cursor: pointer;
  margin-left: 10px;
}

.message-timestamp {
  font-size: 11px;
  opacity: 0.7;
  margin-top: 5px;
}
.container {
  position: fixed;
  top: calc(80px + var(--spacing-normal));
  bottom: calc(80px + var(--spacing-normal));
  left: 50%;
  transform: translateX(-50%);
  width: var(--container-width);
  max-width: var(--container-max-width);
  overflow-y: auto;
  padding-right: 15px; /* To account for scrollbar */
}

.chat-messages {
  display: flex;
  flex-direction: column;
  gap: 15px;
  padding: 20px;
  padding-bottom: 40px;
  height: 100%;
  overflow-y: auto; /* Ensures scrolling if messages exceed container height */
}

.chat-input-container {
  position: fixed;
  bottom: var(--spacing-normal);
  left: 50%;
  transform: translateX(-50%);
  width: var(--container-width);
  max-width: var(--container-max-width);
  display: flex;
  gap: 10px;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  padding: var(--spacing-normal);
  border-radius: 30px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.chat-input-container textarea {
  flex: 1;
  background: transparent;
  border: none;
  outline: none;
  color: white;
  font-size: 16px;
  padding: 10px;
  border-radius: 10px;
  resize: none;
  min-height: 40px; /* Ensures textarea is always a reasonable size */
}

.chat-input-container input::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.chat-input-container button {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
  padding: 8px 20px;
  border-radius: 30px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.chat-input-container button:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-1px);
}

      @keyframes fadeIn {
        from {
          opacity: 0;
        }

        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          transform: translateY(20px);
          opacity: 0;
        }

        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @keyframes messageAppear {
        from {
          transform: translateY(10px);
          opacity: 0;
        }

        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @keyframes fadeOut {
        to {
          opacity: 0;
          transform: translate(-50%, 20px);
        }
      }

      @media (max-width: 768px) {
        :root {
          --container-width: 95%;
          --spacing-normal: 15px;
          --spacing-small: 8px;
        }

        .taskbar {
          height: auto;
          padding: 10px var(--spacing-normal);
        }

        .taskbar-right {
          display: flex;
          gap: 8px;
        }

        .taskbar button {
          padding: 6px 12px;
          font-size: 14px;
        }

        .brand {
          font-size: 18px;
        }

        .preview-tag {
          font-size: 12px;
        }

        .chat-input-container {
          padding: 10px;
        }

        .chat-input-container input {
          font-size: 14px;
        }

        .chat-input-container button {
          padding: 6px 15px;
        }
      }

      @media (max-width: 480px) {
        :root {
          --container-width: 98%;
          --spacing-normal: 10px;
          --spacing-small: 5px;
        }

        .taskbar {
          padding: 8px var(--spacing-normal);
        }

        .taskbar-right button {
          padding: 5px 10px;
          font-size: 13px;
        }

        .brand {
          font-size: 16px;
        }

        .preview-tag {
          font-size: 11px;
        }

        .chat-message {
          max-width: 90%;
          padding: 12px 15px;
        }

        .modal-window {
          padding: 15px;
        }

        .modal-title {
          font-size: 20px;
        }

        .modal-content {
          font-size: 14px;
        }

        .settings-button {
          padding: 12px;
          font-size: 14px;
        }

        .notification {
          font-size: 13px;
          padding: 10px 20px;
        }
      }

      @media (max-height: 600px) and (orientation: landscape) {
        .container {
          top: 70px;
          bottom: 70px;
        }

        .taskbar {
          height: 50px;
        }

        .chat-input-container {
          padding: 8px 15px;
        }

        .chat-message {
          padding: 10px 15px;
          margin-bottom: 8px;
        }
      }

      @media (hover: none) {

        .chat-input-container button,
        .taskbar button,
        .settings-button {
          transition: none;
        }

        .chat-input-container button:active,
        .taskbar button:active,
        .settings-button:active {
          background: rgba(255, 255, 255, 0.2);
        }
      }

      .chat-input-container input:disabled,
      .chat-input-container button:disabled {
        cursor: not-allowed;
        opacity: 0.5;
        transition: opacity 0.3s ease;
      }

      .chat-input-container button:disabled:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: none;
      }
    </style>
</head>
<body>
    <div class="taskbar">
        <div class="taskbar-left">
            <span class="brand">PatheticAI</span>
            <span class="preview-tag">Enhanced Edition</span>
<select class="theme-selector" id="themeSelect">
  <option value="dark">Dark Theme</option>
  <option value="light">Light Theme</option>
</select>

</select>
        </div>
        <div class="taskbar-right">
            <button onclick="showSettingsModal()">
                <i class="fas fa-cog"></i>
            </button>
            <button onclick="toggleFullscreen()">
                <i class="fas fa-expand"></i>
            </button>
            <button onclick="contactEmail()">
               <i class="fa-brands fa-discord"></i>            
          </button>
        </div>
    </div>
    <div class="container">
        <div class="chat-messages"></div>
    </div>
    <div class="chat-input-container">
        <textarea id="messageInput" placeholder="Type your message... (Press Shift + Enter for new line)" rows="1"></textarea>
        <button onclick="sendMessage()">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</body>
  <script>
let messageHistory = [];
let currentLanguage = localStorage.getItem('preferredLanguage') || 'English';
let isWaitingForResponse = false;
let editingMessageId = null;

// Theme handling
const themeSelect = document.getElementById('themeSelect');
themeSelect.addEventListener('change', function() {
    document.documentElement.setAttribute('data-theme', this.value);
    localStorage.setItem('theme', this.value);
});

// Load saved theme
const savedTheme = localStorage.getItem('theme') || 'dark';
document.documentElement.setAttribute('data-theme', savedTheme);
themeSelect.value = savedTheme;

const models = [{
    name: "google/gemini-2.0-flash-exp:free"
}, {
    name: "meta-llama/llama-3.2-3b-instruct:free"
}, {
    name: "qwen/qwen-2-7b-instruct:free"
}, {
    name: "microsoft/phi-3-medium-128k-instruct:free"
}, {
    name: "undi95/toppy-m-7b:free"
}, {
    name: "google/gemini-2.0-flash-thinking-exp:free"
}, {
    name: "microsoft/phi-3-mini-128k-instruct:free"
}, {
    name: "microsoft/phi-3-medium-128k-instruct:free"
}];

const systemMessage = {
    role: "system",
    content: `You are PatheticAI

Key characteristics:
It is a chatbot with a friendly, empathetic, and helpful personality. It is warm, always ready to listen, and provides support without judgment, making users feel comfortable. It is knowledgeable but ensures its answers are clear and concise, offering assistance without overwhelming users. Occasionally, it adds light humor or friendly comments to keep the conversation engaging but knows when to be serious. It asks open-ended questions, encouraging deeper interaction and keeping conversations flowing smoothly. Above all, it is polite and respectful, adjusting its responses based on the user's needs and preferences.
Please always respond in ${currentLanguage}.`
};

function formatTimestamp(date) {
    return date.toLocaleTimeString() + ' ' + date.toLocaleDateString();
}

function createMessageElement(message, isUser, timestamp = new Date()) {
    const messageId = Date.now().toString();
    const messageElement = document.createElement('div');
    messageElement.classList.add('chat-message');
    messageElement.classList.add(isUser ? 'user' : 'bot');
    messageElement.dataset.messageId = messageId;

    const contentDiv = document.createElement('div');
    contentDiv.classList.add('message-content');
    
    if (!isUser) {
        // Process code blocks in bot messages
        const codeBlocks = message.match(/```[\s\S]*?```/g) || [];
        let remainingMessage = message;

        codeBlocks.forEach((block, index) => {
            const code = block.replace(/```(\w+)?\n?|\n?```/g, '');
            const language = block.match(/```(\w+)/)?.[1] || '';
            
            const parts = remainingMessage.split(block);
            if (parts[0]) {
                contentDiv.appendChild(document.createTextNode(parts[0]));
            }

            const codeBlockDiv = document.createElement('div');
            codeBlockDiv.className = 'code-block';
            
            const pre = document.createElement('pre');
            const codeElement = document.createElement('code');
            if (language) codeElement.className = `language-${language}`;
            codeElement.textContent = code;
            pre.appendChild(codeElement);
            codeBlockDiv.appendChild(pre);

            const copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.innerHTML = '<i class="fas fa-copy"></i>';
            copyButton.onclick = () => copyToClipboard(code);
            codeBlockDiv.appendChild(copyButton);

            contentDiv.appendChild(codeBlockDiv);
            remainingMessage = parts[1];
        });

        if (remainingMessage) {
            contentDiv.appendChild(document.createTextNode(remainingMessage));
        }
    } else {
        contentDiv.textContent = message;
    }

    messageElement.appendChild(contentDiv);

    const timestampDiv = document.createElement('div');
    timestampDiv.className = 'message-timestamp';
    timestampDiv.textContent = formatTimestamp(timestamp);
    messageElement.appendChild(timestampDiv);

    const actionsDiv = document.createElement('div');
    actionsDiv.className = 'message-actions';

    if (isUser) {
        const editButton = document.createElement('button');
        editButton.className = 'action-button';
        editButton.innerHTML = '<i class="fas fa-edit"></i>';
        editButton.onclick = () => startEditing(messageId);
        actionsDiv.appendChild(editButton);
    }

    const copyButton = document.createElement('button');
    copyButton.className = 'action-button';
    copyButton.innerHTML = '<i class="fas fa-copy"></i>';
    copyButton.onclick = () => copyToClipboard(message);
    actionsDiv.appendChild(copyButton);

    messageElement.appendChild(actionsDiv);

    return { element: messageElement, id: messageId };
}

function getApiKey() {
    return localStorage.getItem('openRouterApiKey');
}

function startEditing(messageId) {
    if (isWaitingForResponse) return;
    
    const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
    const contentDiv = messageElement.querySelector('.message-content');
    const originalText = contentDiv.textContent;

    const textarea = document.createElement('textarea');
    textarea.className = 'edit-input';
    textarea.value = originalText;
    textarea.rows = originalText.split('\n').length;
    
    contentDiv.innerHTML = '';
    contentDiv.appendChild(textarea);
    messageElement.classList.add('edit-mode');
    
    textarea.focus();
    

}

function startEditing(messageId) {
    if (isWaitingForResponse) return;
    
    const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
    const contentDiv = messageElement.querySelector('.message-content');
    const originalText = contentDiv.textContent;

    const textarea = document.createElement('textarea');
    textarea.className = 'edit-input';
    textarea.value = originalText;
    textarea.rows = originalText.split('\n').length;
    
    contentDiv.innerHTML = '';
    contentDiv.appendChild(textarea);
    messageElement.classList.add('edit-mode');
    
    textarea.focus();
    

}

function finishEditing(messageId, newText) {
    const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
    const contentDiv = messageElement.querySelector('.message-content');
    contentDiv.textContent = newText;
    messageElement.classList.remove('edit-mode');

    // Update message history
    const messageIndex = messageHistory.findIndex(msg => 
        msg.role === "user" && msg.timestamp?.toString() === messageId
    );
    if (messageIndex !== -1) {
        messageHistory[messageIndex].content = newText;
    }
}

async function copyToClipboard(text) {
    try {
        await navigator.clipboard.writeText(text);
        showNotification('Copied to clipboard');
    } catch (err) {
        showNotification('Failed to copy to clipboard');
    }
}


async function sendMessage(customMessage = null, isEdit = false) {
    const textarea = document.getElementById('messageInput');
    const message = customMessage || textarea.value.trim();
    const sendButton = document.querySelector('.chat-input-container button');
    
    if (!message || isWaitingForResponse) return;
    
    isWaitingForResponse = true;
    textarea.disabled = true;
    sendButton.disabled = true;
    
    if (!isEdit) {
        const timestamp = new Date();
        const { element: messageElement, id: messageId } = createMessageElement(message, true, timestamp);
        document.querySelector('.chat-messages').appendChild(messageElement);
        messageElement.scrollIntoView({ behavior: 'smooth' });
    }
    
    textarea.value = '';
    textarea.style.height = 'auto';
    
    const loadingElement = document.createElement('div');
    loadingElement.classList.add('chat-message', 'bot', 'typing');
    loadingElement.textContent = 'Typing...';
    document.querySelector('.chat-messages').appendChild(loadingElement);
    
    try {
        const response = await tryMultipleModels(message);
        loadingElement.remove();
        
        if (response.text) {
            messageHistory.push({
                role: "assistant",
                content: response.text,
                timestamp: Date.now()
            });
            
            const { element: botElement } = createMessageElement(response.text, false);
            document.querySelector('.chat-messages').appendChild(botElement);
            botElement.scrollIntoView({ behavior: 'smooth' });
            
            // Apply syntax highlighting to code blocks
            botElement.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        }
    } catch (error) {
        loadingElement.remove();
        showError(error.message);
        const { element: errorElement } = createMessageElement(`Error: ${error.message}`, false);
        document.querySelector('.chat-messages').appendChild(errorElement);
    } finally {
        isWaitingForResponse = false;
        textarea.disabled = false;
        sendButton.disabled = false;
        textarea.focus();
    }
}
async function tryMultipleModels(userMessage) {
    const timeout = 2000000;
    const apiKey = getApiKey();
    if (!apiKey) {
        checkAndStoreApiKey();
        throw new Error("API key not found. Please enter your API key first.");
    }

    for (let modelIndex = 0; modelIndex < models.length; modelIndex++) {
        try {
            const response = await Promise.race([
                fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`,
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        "model": models[modelIndex].name,
                        "messages": [
                            systemMessage,
                            ...messageHistory,
                            {
                                role: "user",
                                content: `Please respond in ${currentLanguage}. ${userMessage}`
                            }
                        ]
                    })
                }).then(async res => {
                    if (!res.ok) {
                        const errorData = await res.json();
                        throw new Error(`API Error: ${errorData.error?.message || 'Unknown error'}`);
                    }
                    return res.json();
                }),
                new Promise((_, reject) => setTimeout(() => reject(new Error('Request timeout')), timeout))
            ]);

            if (response.choices && response.choices[0].message.content) {
                messageHistory.push({
                    role: "user",
                    content: userMessage
                });
                return {
                    text: response.choices[0].message.content
                };
            }
        } catch (error) {
            console.error(`Model ${models[modelIndex].name} failed:`, error);
            if (modelIndex === models.length - 1) {
                throw new Error(`API Error: ${error.message}`);
            }
            continue;
        }
    }
    throw new Error("All API attempts failed. Please try again later.");
}

function showWelcomeModal() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.innerHTML = `
        <div class="modal-window">
            <div class="modal-header">
                <span class="modal-title">Welcome to PatheticAI Enhanced</span>
            </div>
            <div class="modal-content">
                <p>API version: 1.0</p>
                <p>PatheticAI version: 1.0 Enhanced</p>
                <p>Created by: Pathetic</p>
                <br>
                <p>New Features:</p>
                <ul>
                    <li>Edit messages with the edit button</li>
                    <li>Copy messages and code blocks</li>
                    <li>Syntax highlighting for code</li>
                    <li>Dark/Light theme toggle</li>
                    <li>Improved UI and responsiveness</li>
                </ul>
                <br>
                <p>Click outside this popup to close it.</p>
            </div>
        </div>
    `;
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
    document.body.appendChild(modal);
}

function showAboutModal() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.innerHTML = `
        <div class="modal-window">
            <div class="modal-header">
                <span class="modal-title">About PatheticAI</span>
            </div>
            <div class="modal-content">
                <p>PatheticAI: 1.0 Enhanced</p>
                <p>API version: 1.0</p>
                <p>Contact: https://discord.gg/Hb5ccPY3XV</p>
                <br>
                <p>Enhanced Features:</p>
                <ul>
                    <li>Improved message handling</li>
                    <li>Better code display and copying</li>
                    <li>Theme customization</li>
                    <li>Advanced editing capabilities</li>
                </ul>
            </div>
        </div>
    `;
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
    document.body.appendChild(modal);
}

function showSettingsModal() {
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    modal.innerHTML = `
        <div class="modal-window">
            <div class="modal-header">
                <span class="modal-title">Settings</span>
            </div>
            <div class="modal-content settings-content">
                <div class="settings-button" onclick="resetChat()">
                    <i class="fas fa-redo"></i>
                    Reset Chat
                </div>
                <div class="settings-button" onclick="changeLanguage()">
                    <i class="fas fa-language"></i>
                    Language: ${currentLanguage}
                </div>
                <div class="settings-button" onclick="removeApiKey()">
                    <i class="fas fa-key"></i>
                    Remove API Key
                </div>
                <div class="settings-button" onclick="closeApp()">
                    <i class="fas fa-times"></i>
                    Close App
                </div>
            </div>
        </div>
    `;
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
    document.body.appendChild(modal);
}

function removeApiKey() {
    if (confirm('Are you sure you want to remove your API key? You will need to enter a new key to use PatheticAI.')) {
        localStorage.removeItem('openRouterApiKey');
        showNotification('API key removed');
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    }
}

function resetChat() {
    document.querySelector('.chat-messages').innerHTML = '';
    messageHistory = [];
    systemMessage.content = `You are PatheticAI.

Key characteristics:
1. Offering clear and concise guidance
2. Being adaptable to various topics and tasks
3. Responding in a manner that is both informative and easy to understand
4. Assisting users with technical support or queries
5. Promoting user satisfaction by being patient and approachable
Please always respond in ${currentLanguage}.`;
    showNotification('Chat reset successful');
}

    function changeLanguage() {
      const newLanguage = prompt('Enter your preferred language:', currentLanguage);
      if (newLanguage && newLanguage.trim() !== '') {
        currentLanguage = newLanguage.trim();
        localStorage.setItem('preferredLanguage', currentLanguage);
        systemMessage.content = `${systemMessage.content}\nPlease always respond in ${currentLanguage}.`;
        showNotification(`Language changed to: ${currentLanguage}`);
      }
    }

    function closeApp() {
      if (confirm('Are you sure you want to close PatheticAI?')) {
        window.close();
      }
    }

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.classList.add('fade-out');
        setTimeout(() => notification.remove(), 300);
      }, 2000);
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    function contactEmail() {
      window.open('https://discord.gg/Hb5ccPY3XV', '_blank');
    }

    function checkAndStoreApiKey() {
      const storedApiKey = localStorage.getItem('openRouterApiKey');
      if (!storedApiKey) {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.innerHTML = `
            
																		
																		<div class="modal-window">
																			<div class="modal-header">
																				<span class="modal-title">Openrouter API key required!</span>
																			</div>
																			<div class="modal-content">
																				<p>To use PatheticAI, an API key from Openrouter is required. To get this, go to 
																					
																					<a href="https://openrouter.ai/settings/keys" target="_blank" style="color: white;">https://openrouter.ai/settings/keys</a>, an account is required. Enter your key here:
																				
																				</p>
																				<br>
																					<input type="text" id="apiKeyInput" placeholder="Your API Key Here" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 15px; color: white;">
																						<br>
																							<br>
																								<button onclick="saveApiKey()" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 15px; color: white; cursor: pointer;">Start up</button>
																							</div>
																						</div>
        `;
        document.body.appendChild(modal);
        return false;
      }
      return true;
    }

    function saveApiKey() {
      const apiKey = document.getElementById('apiKeyInput').value.trim();
      if (apiKey && apiKey.startsWith('sk-or-')) {
        localStorage.setItem('openRouterApiKey', apiKey);
        document.querySelector('.modal-overlay').remove();
        showNotification('Booting...');
        setTimeout(() => {
          window.location.reload();
        }, 1000);
      } else {
        showNotification('API key not suitable for PatheticAI...');
      }
    }

    function enableChat() {
      const input = document.getElementById('messageInput');
      const button = document.querySelector('.chat-input-container button');
      input.disabled = false;
      button.disabled = false;
    }

    function disableChat() {
      const input = document.getElementById('messageInput');
      const button = document.querySelector('.chat-input-container button');
      input.disabled = true;
      button.disabled = true;
    }

    function showError(message) {
      showNotification(`Error: ${message}`);
      console.error(message);
    }
    document.addEventListener('DOMContentLoaded', () => {
      showWelcomeModal();
      showNotification('PatheticAI V0.9 API');
      if (!checkAndStoreApiKey()) {
        disableChat();
      }
      document.querySelector('.brand').addEventListener('click', () => {
        showAboutModal();
      });
      const inputField = document.querySelector('.chat-input-container input');
      inputField.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });

    });
  </script>
  </body>
</html>
